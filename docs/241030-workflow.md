### 2024-10-30  10:35
---------------------

**План работы над проектом vpro** _по принципу ручного запуска и остановки ресурсов скриптами_

1. Создать директорию aws-infra и переместить туда Bash скрипты, которые будут служить модулями для развертывания инфорастуктуры
2. Создать модули Bash для запуска серверов db01, mc01 и rmq01 и жестко присвоить им IP
3. Слить ветку aws-man веткой main.
4. Создать новую ветку aws-bash, которая должна отделяться от ветки main.
    В новую ветку aws-bash скопировать файлы из aws-man.
5. Создать основной скрипт Bash для развертывания инфраструктуры, считая, что Cloud Storage уже создано именяться не должно. На данном этапе отдать предпочтение неструктурированному Cloud Storage.
6. Отредактировать основной скрипт Bash для развертывания инфраструктуры таким образом, чтобы:
    - была выдержка 15 минут перед автоматическим удалением развернутой инфраструктуры;
    - создавались VPC, subnets и все, что с этим связано;
    - запускались все четыре экземляра серверов;
    - выполнялся пинг запущенных серверов.
7. Создать модули terraform для запуска серверов db01, mc01 и rmq01 и жестко присвоить им IP
8. Создать модуль terraform для запуска сервера app01, а затем разработать модуль для создания шаблона app01.
9. Отредактировать основной скрипт для развертывания инфраструктуры таким образом, чтобы:
    - была выдержка 15 минут перед автоматическим удалением развернутой инфраструктуры;
    - создавались VPC, subnets и все, что с этим связано;
    - запускались все четыре экземляра серверов;
    - выполнялся пинг запущенных серверов.


### 2024-11-01  12:01
---------------------
Несколько дней работаю над веткой aws-man.
Вчера запустил серверы app01 и db01 в дефолтной VPC.
Данные о проделанной работе - см. директорию ./aws-man/aws-default-vpc-infra/
Подробнее - см. коммит 605886274106ea948c3ae677ef3318efc985d715

Актуальное состояние требует работы над правилами доступа к облачному хранилищу AWS S3.
Решил следующее:
- создать роль для доступа к AWS S3 bucket
- доработать скрипты создания AWS S3 bucket и экземпляров всех серверов таким образом, чтобы они могли загрузить файлы из AWS S3 bucket
- запустить экземпляры серверов фронтенда app01 в дефолтной подсети
        FRONTEND_CIDR="172.31.48.0/20"
- в подсети 172.31.48.0/20 создать Autoscaling Group
- запустить по одному экземпляру серверов db01, mc01 и rmq01 в дефолтной подсети
        BACKEND_CIDR="172.31.64.0/20"
- создать Security Groups, которые сделают подсеть 172.31.64.0/20 приватной, доступной только из 172.31.48.0/20 (далее BACKEND_SUBNET и FRONTEND_SUBNET соответственно)
- разработать скрипт bash верхнего уровня для запуска тестовой среды с четырьмя серверами (без автомасштабирования);
- разработать конфигурацию terraform для того, чтобы развернуть такую же инфраструктуру.

#### Шаги для предоставления необходимых прав:
1. *Перейди в консоль AWS IAM*:
   - Зайди в [консоль AWS IAM](https://console.aws.amazon.com/iam/home).

2. *Найди пользователя*:
   - В левой панели выберите "Users" (Пользователи).
   - Найди и выберите пользователя.

3. *Добавь необходимые разрешения*:
   - Перейди на вкладку "Permissions" (Разрешения).
   - Нажми на кнопку "Add permissions" (Добавить разрешения).
   - Выберите "Attach existing policies directly" (Присоединить существующие политики напрямую).

4. *Выбери необходимые политики*:
   - Вам нужно будет добавить политику, которая предоставляет разрешения на создание ролей и управление IAM. Вы можете использовать следующие политики:
     - *IAMFullAccess*: Полная доступ к IAM (включая создание ролей).
     - *IAMReadOnlyAccess*: Чтение информации о IAM (необходима только для просмотра, но не для создания).
   - Если вы хотите предоставить более ограниченные права, вы можете создать пользовательскую политику с необходимыми разрешениями. Вот пример такой политики:

```json
{
   "Version": "2012-10-17",
   "Statement": [
       {
           "Effect": "Allow",
           "Action": [
               "iam:CreateRole",
               "iam:PutRolePolicy",
               "iam:AttachRolePolicy",
               "iam:PassRole",
               "iam:DeleteRolePolicy",
               "iam:DeleteRole"
           ],
           "Resource": "arn:aws:iam::YOUR_ACCOUNT_ID:role/EC2S3AccessRole"
       }
   ]
}
```

5. *Сохраните изменения*:
   - После выбора необходимых политик нажмите "Next: Review" (Далее: Обзор) и затем "Add permissions" (Добавить разрешения).

##### Примечания:
- *Безопасность*: Будьте осторожны с предоставлением широких прав, таких как `IAMFullAccess`. Если это возможно, старайтесь предоставлять только те разрешения, которые необходимы для выполнения конкретных задач.
- *Политики*: Если вы создаете пользовательскую политику, убедитесь, что вы предоставляете доступ только к тем ресурсам, которые необходимы, а не ко всем ресурсам (`"Resource": "*"`).